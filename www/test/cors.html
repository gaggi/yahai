<!DOCTYPE html>
<!--
Platz fuer Kommentare
-->
<html>
  <head> 
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>yaHAi</title>
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link href="css/jquery.mobile.css" rel="stylesheet" type="text/css" /> 
	<link href="css/split-view.css" rel="stylesheet" type="text/css" /> 
	<script src="js/jquery.js"></script> 
	<script src="js/jquery.cookie.js"></script> 
    <script src="js/jquery.base64.js"></script>
	<script src="js/jquery.mobile.js"></script> 
	<script> 
	jQuery.support.cors = true;
	$("#serverTest").live("click", function() {
		$.ajax({
			type: "GET",
			url: $('#address').val()+':'+$('#port').val()+'/fhem',
			data: { cmd: 'jsonlist', XHR: 1, CORS: 1 },
			crossDomain: true,
			xhrFields: {
			   withCredentials: true
			},
		
			// working in chrome, ie, mobile safari and mobile chrome
			headers: { 
				'Authorization': 'Basic '+$.base64.encode($('#username').val()+':'+$('#password').val()+':x'),
//				'Content-Type': 'application/x-www-form-urlencoded'
			},

			error: function(data,error,errormsg){
				$('#serverTestLog').html('<h3><span style="color: red">'+error+'</h3></span><p>'+errormsg+'</p>');
			},
			success: function(data){
				$('#serverTestLog').html('<h3><span style="color: green">success</h3><p>'+$.base64.encode($('#username').val()+':'+$('#password').val()+':x')+'</p>');
			}
		});
	});
	</script> 
	</head> 
	<body>

		<div data-role="fieldcontain">
			<label for="address">Server:</label>
			<input type="text" name="address" id="address" value=""  />
		</div>	
		<div data-role="fieldcontain">
			<label for="port">Port:</label>
			<input type="text" name="port" id="port" value=""  />
		</div>	
		<div data-role="fieldcontain">
			<label for="username">Benutzer:</label>
			<input type="text" name="username" id="username" value=""  />
		</div>	
		<div data-role="fieldcontain">
			<label for="password">Passwort:</label>
			<input type="text" name="password" id="password" value=""  />
		</div>		
	
		<a href="#" data-role="button" data-theme="c" id="serverTest">test</a>
		<div data-role="collapsible" data-content-theme="" id="serverTestLog" data-collapsed="false"></div>
	</body> 
</html>